@import url('https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap');

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --sidebar-w: 340px;
  --space-1: 8px;
  --space-2: 12px;
  --space-3: 16px;
  --space-4: 24px;
  --control-h: 40px;
  --control-h-sm: 34px;
  --bg: #0f1727;
  --bg-grad: radial-gradient(1200px circle at 20% -10%, #273f68 0%, rgba(39, 63, 104, 0.08) 42%, transparent 70%);
  --surface: #13233d;
  --surface2: #1b3358;
  --surface3: #223f6b;
  --accent: #ff5f7e;
  --accent-strong: #ff4066;
  --accent2: #2d6cb2;
  --accent2-strong: #215287;
  --success: #2fbf75;
  --danger: #cc4b45;
  --text: #eef3ff;
  --text-dim: #9eb1d1;
  --border-soft: #2f4d7d;
  --radius: 10px;
  --radius-sm: 8px;
  --shadow-card: 0 10px 28px rgba(7, 12, 23, 0.34);
}
body {
  font-family: 'Manrope', 'Avenir Next', 'Segoe UI', sans-serif;
  font-size: 15px;
  background: var(--bg);
  background-image: var(--bg-grad);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
  letter-spacing: 0.01em;
}

/* Sidebar */
.sidebar {
  width: var(--sidebar-w); min-width: var(--sidebar-w); background: linear-gradient(180deg, #15305a 0%, #10233f 100%);
  padding: var(--space-2); overflow-y: auto; display: flex; flex-direction: column; gap: var(--space-2);
  border-right: 1px solid var(--border-soft);
}
.sidebar h1 {
  font-size: 2rem;
  line-height: 1.1;
  font-weight: 800;
  color: #ff4f71;
  text-shadow: 0 6px 16px rgba(255, 79, 113, 0.18);
}
.section {
  background: linear-gradient(180deg, var(--surface2) 0%, #1a3155 100%);
  border-radius: var(--radius);
  padding: var(--space-2);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-card);
}
.section h3 {
  font-size: 0.76rem;
  text-transform: uppercase;
  color: #bdd0ee;
  margin-bottom: var(--space-1);
  letter-spacing: 0.08em;
  font-weight: 800;
}
label { font-size: 0.78rem; color: #bac9e2; display: block; margin-bottom: 5px; font-weight: 600; }
input, select {
  width: 100%; min-height: var(--control-h); padding: 9px 10px; border: 1px solid #395984; border-radius: 8px;
  background: #111f36; color: var(--text); font-size: 0.84rem; outline: none;
}
input[type='checkbox'], input[type='radio'] { width: auto; min-height: 0; padding: 0; }
input:focus, select:focus { border-color: var(--accent); }
button:focus-visible, input:focus-visible, select:focus-visible { outline: 2px solid rgba(255, 95, 126, 0.85); outline-offset: 2px; }
.row { display: flex; gap: var(--space-1); align-items: flex-end; }
.row > * { flex: 1; }
.btn {
  min-height: var(--control-h); padding: 9px 12px; border: 1px solid transparent; border-radius: 8px; cursor: pointer;
  font-size: 0.84rem; font-weight: 700; line-height: 1.2; transition: background 0.18s ease, transform 0.18s ease, border-color 0.18s ease;
  touch-action: manipulation;
}
.btn-primary { background: var(--accent); color: #fff; border-color: rgba(255, 255, 255, 0.15); }
.btn-primary:hover { background: var(--accent-strong); }
.btn-secondary { background: var(--accent2); color: #fff; border-color: rgba(255, 255, 255, 0.12); }
.btn-secondary:hover { background: var(--accent2-strong); }
.btn-sm { min-height: var(--control-h-sm); padding: 6px 10px; font-size: 0.78rem; }
.btn-danger { background: var(--danger); color: #fff; }
.btn-danger:hover { background: #b73f39; }
.unit-toggle { display: flex; border-radius: 8px; overflow: hidden; border: 1px solid #355a8b; }
.unit-toggle button {
  flex: 1; min-height: var(--control-h); padding: 9px; border: none; background: #11213a; color: var(--text-dim);
  cursor: pointer; font-size: 0.84rem; transition: all 0.2s;
}
.unit-toggle button.active { background: var(--accent); color: #fff; }
.photo-list { display: flex; flex-direction: column; gap: 5px; margin-top: 6px; }
.photo-item {
  display: grid; grid-template-columns: 14px 1fr auto; align-items: center; gap: 7px; padding: 6px;
  background: var(--bg); border-radius: 6px;
}
.photo-item .swatch { width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; }
.photo-item-fields { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 5px; }
.photo-item-fields label { margin: 0; font-size: 0.66rem; }
.photo-item-fields input { min-height: 28px; padding: 5px 7px; font-size: 0.76rem; }
.photo-item-actions { display: flex; align-items: center; gap: 6px; }
.photo-item-unit { font-size: 0.72rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.4px; }
.preset-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: var(--space-1); }
.preset-chip {
  min-height: var(--control-h-sm); padding: 6px 11px; border-radius: 18px; font-size: 0.78rem; cursor: pointer;
  background: #111f36; border: 1px solid #3a5b88; color: var(--text-dim); transition: all 0.2s;
  touch-action: manipulation;
}
.preset-chip:hover { border-color: var(--accent); color: var(--text); }
.actions { display: flex; flex-direction: column; gap: 6px; margin-top: auto; }
.actions h3 { font-size: 0.9rem; text-transform: uppercase; color: var(--text-dim); letter-spacing: 0.5px; }
.export-checks { align-items: center; gap: var(--space-2); flex-wrap: wrap; }
.export-checks label { margin: 0; display: flex; align-items: center; gap: 6px; color: var(--text); font-size: 0.82rem; }
.layout-checks { align-items: center; gap: var(--space-2); flex-wrap: wrap; }
.layout-checks label { margin: 0; display: flex; align-items: center; gap: 6px; color: var(--text); font-size: 0.82rem; }

.layout-feedback {
  border-radius: var(--radius-sm);
  border: 1px solid #355c8e;
  padding: 8px 10px;
  font-size: 0.8rem;
}
.layout-feedback.info { background: rgba(52, 152, 219, 0.14); color: #d2e6ff; border-color: #46709c; }
.layout-feedback.success { background: rgba(47, 191, 117, 0.16); color: #d6f8e3; border-color: #2f7b4f; }
.layout-feedback.warn { background: rgba(204, 75, 69, 0.16); color: #ffd8d5; border-color: #92443f; }

/* Main canvas area */
.main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-4); position: relative; overflow: auto; gap: var(--space-2); }
.top-controls {
  width: min(100%, 1200px);
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.canvas-toolbar {
  width: 100%;
  display: flex;
  flex-wrap: wrap;
  gap: 12px 14px;
  align-items: flex-start;
  justify-content: flex-start;
  background: linear-gradient(180deg, #1d3965 0%, #16335a 100%);
  border: 1px solid var(--border-soft);
  border-radius: var(--radius);
  padding: 12px 14px;
  box-shadow: var(--shadow-card);
}
.toolbar-group {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  position: relative;
  padding-top: 16px;
}
.toolbar-group + .toolbar-group {
  border-left: 1px solid rgba(238, 243, 255, 0.22);
  padding-left: 14px;
}
.toolbar-group::before {
  position: absolute;
  top: 0;
  left: 0;
  font-size: 0.68rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #b3c8ec;
  font-weight: 800;
}
.toolbar-group:first-child::before { content: 'Layout + Export'; }
.toolbar-group:last-child::before { content: 'Alignment'; }
.toolbar-group:first-child .btn-primary {
  min-height: 34px;
  padding-inline: 14px;
  box-shadow: 0 8px 18px rgba(255, 64, 102, 0.28);
}
.toolbar-group:first-child button:nth-child(2),
.toolbar-group:first-child button:nth-child(3) {
  background: rgba(45, 108, 178, 0.18);
  border-color: rgba(200, 220, 248, 0.26);
  color: #d9e6fb;
}
.toolbar-group:first-child button:nth-child(4) {
  background: rgba(17, 31, 54, 0.5);
  border-color: rgba(200, 220, 248, 0.36);
  color: #d9e6fb;
}
.toolbar-group:first-child button:nth-child(4):hover {
  background: rgba(29, 57, 101, 0.8);
}
.canvas-secondary {
  width: 100%;
  display: grid;
  grid-template-columns: minmax(360px, 2fr) minmax(260px, 1fr);
  gap: 10px;
  align-items: start;
}
.canvas-secondary .section { margin: 0; }
.export-section summary {
  list-style: none;
  cursor: pointer;
  font-size: 0.82rem;
  text-transform: uppercase;
  color: var(--text-dim);
  letter-spacing: 0.5px;
  font-weight: 600;
}
.export-section summary::-webkit-details-marker { display: none; }
.export-section summary::before {
  content: '\25B6';
  display: inline-block;
  margin-right: 8px;
  transform: translateY(-1px);
}
.export-section[open] summary::before { content: '\25BC'; }
.export-section .export-body { margin-top: 6px; }
.project-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.project-actions {
  display: flex;
  justify-content: flex-start;
}
.canvas-stage {
  width: 100%;
  flex: 1;
  min-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.canvas-wrapper { position: relative; background: #fff; box-shadow: 0 4px 24px rgba(0,0,0,0.4); }
.canvas-wrapper.grid-visible {
  background-image:
    linear-gradient(to right, rgba(15, 52, 96, 0.12) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(15, 52, 96, 0.12) 1px, transparent 1px),
    linear-gradient(to right, rgba(15, 52, 96, 0.2) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(15, 52, 96, 0.2) 1px, transparent 1px);
  background-size:
    var(--grid-step, 24px) var(--grid-step, 24px),
    var(--grid-step, 24px) var(--grid-step, 24px),
    var(--grid-major-step, 120px) var(--grid-major-step, 120px),
    var(--grid-major-step, 120px) var(--grid-major-step, 120px);
  background-position: 0 0, 0 0, 0 0, 0 0;
}
.canvas-wrapper .dim-label {
  position: absolute; font-size: 11px; color: var(--text-dim); white-space: nowrap;
}
.canvas-wrapper .dim-label.top { top: -18px; left: 50%; transform: translateX(-50%); }
.canvas-wrapper .dim-label.left { left: -50px; top: 50%; transform: translateY(-50%) rotate(-90deg); }

/* Photo rectangles */
.photo-rect {
  position: absolute; border: 2px solid rgba(0,0,0,0.3); cursor: grab;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  font-size: 11px; color: #fff; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  user-select: none; transition: box-shadow 0.15s;
}
.photo-rect:hover { box-shadow: 0 0 0 2px var(--accent), 0 2px 8px rgba(0,0,0,0.3); z-index: 100; }
.photo-rect.selected { box-shadow: 0 0 0 3px var(--accent), 0 4px 12px rgba(0,0,0,0.4); z-index: 101; }
.photo-rect.dragging { cursor: grabbing; opacity: 0.85; }
.photo-rect .dim-text { font-size: 10px; opacity: 0.9; }
.photo-rect .rotate-btn {
  position: absolute; top: 2px; right: 2px; width: 22px; height: 22px;
  background: rgba(0,0,0,0.5); border: none; border-radius: 50%; color: #fff;
  font-size: 12px; cursor: pointer; display: none; align-items: center; justify-content: center;
}
.photo-rect .delete-btn {
  position: absolute; top: 2px; left: 2px; width: 22px; height: 22px;
  background: rgba(192, 57, 43, 0.85); border: none; border-radius: 50%; color: #fff;
  font-size: 12px; cursor: pointer; display: none; align-items: center; justify-content: center;
}
.photo-rect:hover .rotate-btn, .photo-rect.selected .rotate-btn,
.photo-rect:hover .delete-btn, .photo-rect.selected .delete-btn { display: flex; }
.photo-rect .resize-handle {
  position: absolute; bottom: 0; right: 0; width: 14px; height: 14px;
  cursor: nwse-resize; background: rgba(0,0,0,0.4);
  clip-path: polygon(100% 0, 100% 100%, 0 100%);
}
.photo-rect:hover .resize-handle, .photo-rect.selected .resize-handle { background: var(--accent); }
.overlap-warning { border-color: #e74c3c !important; }
.out-of-bounds-warning { border-color: #f39c12 !important; }
.gap-guide {
  position: absolute;
  pointer-events: none;
  z-index: 180;
}
.gap-guide.x {
  border-top: 1px dashed rgba(15, 52, 96, 0.65);
}
.gap-guide.y {
  border-left: 1px dashed rgba(15, 52, 96, 0.65);
}
.gap-label {
  position: absolute;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(15, 52, 96, 0.3);
  border-radius: 3px;
  padding: 1px 4px;
  font-size: 10px;
  color: #23395d;
  pointer-events: none;
  z-index: 181;
  white-space: nowrap;
}
.marquee-box {
  position: absolute;
  border: 1px dashed rgba(233, 69, 96, 0.9);
  background: rgba(233, 69, 96, 0.16);
  pointer-events: none;
  z-index: 250;
}

.empty-state { color: var(--text-dim); text-align: center; font-size: 0.9rem; }
.empty-state p { margin-top: 8px; font-size: 0.8rem; }

.toast {
  position: fixed; bottom: 20px; right: 20px; padding: 10px 18px;
  background: var(--surface2); color: var(--text); border-radius: var(--radius);
  font-size: 0.85rem; box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 1000;
}
.toast.show { opacity: 1; }

.keyboard-hint { font-size: 0.73rem; color: var(--text-dim); text-align: center; line-height: 1.28; }

@media (max-height: 920px) and (min-width: 901px) {
  .sidebar { padding: 10px; gap: 8px; }
  .section { padding: 8px; }
  .section h3 { font-size: 0.76rem; margin-bottom: 5px; }
  .export-section summary { font-size: 0.76rem; }
  .export-section .export-body { margin-top: 5px; }
  .row { gap: 6px; }
  input, select { min-height: 34px; padding: 6px 8px; font-size: 0.8rem; }
  .btn { min-height: 34px; padding: 6px 10px; font-size: 0.8rem; }
  .btn-sm { min-height: 28px; padding: 4px 7px; font-size: 0.74rem; }
  .preset-chip { min-height: 28px; padding: 4px 8px; font-size: 0.74rem; }
  .layout-feedback { padding: 6px 8px; font-size: 0.76rem; }
  .keyboard-hint { font-size: 0.69rem; line-height: 1.2; }
}

@media (max-height: 780px) and (min-width: 901px) {
  .keyboard-hint { display: none; }
}

@media (max-width: 900px) {
  body {
    flex-direction: column;
    min-height: 100vh;
    height: auto;
    overflow: auto;
  }
  .sidebar {
    width: 100%;
    min-width: 0;
    border-right: none;
    border-bottom: 1px solid var(--surface2);
  }
  .main { padding: 16px; justify-content: flex-start; }
  .top-controls { width: 100%; }
  .canvas-toolbar { justify-content: flex-start; }
  .canvas-secondary {
    grid-template-columns: 1fr;
  }
  .toolbar-group + .toolbar-group {
    border-left: none;
    padding-left: 0;
  }
}
