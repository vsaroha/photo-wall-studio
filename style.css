*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --sidebar-w: 340px;
  --bg: #1a1a2e;
  --surface: #16213e;
  --surface2: #0f3460;
  --accent: #e94560;
  --accent2: #533483;
  --text: #eee;
  --text-dim: #aaa;
  --radius: 8px;
}
body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  font-size: 15px;
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: var(--sidebar-w); min-width: var(--sidebar-w); background: var(--surface);
  padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px;
  border-right: 1px solid var(--surface2);
}
.sidebar h1 { font-size: 1.45rem; color: var(--accent); }
.section { background: var(--surface2); border-radius: var(--radius); padding: 12px; }
.section h3 { font-size: 0.9rem; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px; letter-spacing: 0.5px; }
label { font-size: 0.85rem; color: var(--text-dim); display: block; margin-bottom: 4px; }
input, select {
  width: 100%; min-height: 36px; padding: 8px 10px; border: 1px solid #333; border-radius: 4px;
  background: var(--bg); color: var(--text); font-size: 0.92rem; outline: none;
}
input[type='checkbox'], input[type='radio'] { width: auto; min-height: 0; padding: 0; }
input:focus, select:focus { border-color: var(--accent); }
button:focus-visible, input:focus-visible, select:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
.row { display: flex; gap: 10px; align-items: end; }
.row > * { flex: 1; }
.btn {
  min-height: 38px; padding: 10px 14px; border: none; border-radius: 6px; cursor: pointer;
  font-size: 0.9rem; font-weight: 600; line-height: 1.2; transition: background 0.2s;
  touch-action: manipulation;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: #c73550; }
.btn-secondary { background: var(--accent2); color: #fff; }
.btn-secondary:hover { background: #6a42a8; }
.btn-sm { min-height: 34px; padding: 6px 10px; font-size: 0.82rem; }
.btn-danger { background: #c0392b; color: #fff; }
.btn-danger:hover { background: #a93226; }
.unit-toggle { display: flex; border-radius: 4px; overflow: hidden; border: 1px solid #333; }
.unit-toggle button {
  flex: 1; min-height: 38px; padding: 9px; border: none; background: var(--bg); color: var(--text-dim);
  cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
}
.unit-toggle button.active { background: var(--accent); color: #fff; }
.photo-list { display: flex; flex-direction: column; gap: 6px; margin-top: 8px; }
.photo-item {
  display: grid; grid-template-columns: 14px 1fr auto; align-items: center; gap: 8px; padding: 8px;
  background: var(--bg); border-radius: 6px;
}
.photo-item .swatch { width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; }
.photo-item-fields { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 6px; }
.photo-item-fields label { margin: 0; font-size: 0.7rem; }
.photo-item-fields input { min-height: 32px; padding: 6px 8px; font-size: 0.82rem; }
.photo-item-actions { display: flex; align-items: center; gap: 6px; }
.photo-item-unit { font-size: 0.72rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.4px; }
.preset-chips { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
.preset-chip {
  min-height: 34px; padding: 6px 10px; border-radius: 14px; font-size: 0.82rem; cursor: pointer;
  background: var(--bg); border: 1px solid #444; color: var(--text-dim); transition: all 0.2s;
  touch-action: manipulation;
}
.preset-chip:hover { border-color: var(--accent); color: var(--text); }
.actions { display: flex; flex-direction: column; gap: 8px; margin-top: auto; }
.export-checks { align-items: center; gap: 12px; flex-wrap: wrap; }
.export-checks label { margin: 0; display: flex; align-items: center; gap: 6px; color: var(--text); font-size: 0.82rem; }
.layout-checks { align-items: center; gap: 12px; flex-wrap: wrap; }
.layout-checks label { margin: 0; display: flex; align-items: center; gap: 6px; color: var(--text); font-size: 0.82rem; }

.layout-feedback {
  border-radius: 6px;
  border: 1px solid #355;
  padding: 9px 10px;
  font-size: 0.84rem;
}
.layout-feedback.info { background: rgba(52, 152, 219, 0.16); color: #b9dcff; border-color: #2c5d79; }
.layout-feedback.success { background: rgba(46, 204, 113, 0.16); color: #bfeecd; border-color: #2f7b4f; }
.layout-feedback.warn { background: rgba(231, 76, 60, 0.16); color: #ffc4bc; border-color: #8e3b31; }

/* Main canvas area */
.main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; position: relative; overflow: auto; }
.canvas-wrapper { position: relative; background: #fff; box-shadow: 0 4px 24px rgba(0,0,0,0.4); }
.canvas-wrapper.grid-visible {
  background-image:
    linear-gradient(to right, rgba(15, 52, 96, 0.12) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(15, 52, 96, 0.12) 1px, transparent 1px),
    linear-gradient(to right, rgba(15, 52, 96, 0.2) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(15, 52, 96, 0.2) 1px, transparent 1px);
  background-size:
    var(--grid-step, 24px) var(--grid-step, 24px),
    var(--grid-step, 24px) var(--grid-step, 24px),
    var(--grid-major-step, 120px) var(--grid-major-step, 120px),
    var(--grid-major-step, 120px) var(--grid-major-step, 120px);
  background-position: 0 0, 0 0, 0 0, 0 0;
}
.shuffle-btn {
  position: absolute; top: -40px; right: 0; min-height: 34px; padding: 6px 12px;
  background: var(--accent2); color: #fff; border: none; border-radius: 4px;
  font-size: 0.9rem; cursor: pointer; z-index: 200; font-weight: 600;
}
.shuffle-btn:hover { background: #6a42a8; }
.canvas-wrapper .dim-label {
  position: absolute; font-size: 11px; color: var(--text-dim); white-space: nowrap;
}
.canvas-wrapper .dim-label.top { top: -18px; left: 50%; transform: translateX(-50%); }
.canvas-wrapper .dim-label.left { left: -50px; top: 50%; transform: translateY(-50%) rotate(-90deg); }

/* Photo rectangles */
.photo-rect {
  position: absolute; border: 2px solid rgba(0,0,0,0.3); cursor: grab;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  font-size: 11px; color: #fff; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  user-select: none; transition: box-shadow 0.15s;
}
.photo-rect:hover { box-shadow: 0 0 0 2px var(--accent), 0 2px 8px rgba(0,0,0,0.3); z-index: 100; }
.photo-rect.selected { box-shadow: 0 0 0 3px var(--accent), 0 4px 12px rgba(0,0,0,0.4); z-index: 101; }
.photo-rect.dragging { cursor: grabbing; opacity: 0.85; }
.photo-rect .dim-text { font-size: 10px; opacity: 0.9; }
.photo-rect .rotate-btn {
  position: absolute; top: 2px; right: 2px; width: 22px; height: 22px;
  background: rgba(0,0,0,0.5); border: none; border-radius: 50%; color: #fff;
  font-size: 12px; cursor: pointer; display: none; align-items: center; justify-content: center;
}
.photo-rect:hover .rotate-btn, .photo-rect.selected .rotate-btn { display: flex; }
.photo-rect .resize-handle {
  position: absolute; bottom: 0; right: 0; width: 14px; height: 14px;
  cursor: nwse-resize; background: rgba(0,0,0,0.4);
  clip-path: polygon(100% 0, 100% 100%, 0 100%);
}
.photo-rect:hover .resize-handle, .photo-rect.selected .resize-handle { background: var(--accent); }
.overlap-warning { border-color: #e74c3c !important; }
.out-of-bounds-warning { border-color: #f39c12 !important; }
.gap-guide {
  position: absolute;
  pointer-events: none;
  z-index: 180;
}
.gap-guide.x {
  border-top: 1px dashed rgba(15, 52, 96, 0.65);
}
.gap-guide.y {
  border-left: 1px dashed rgba(15, 52, 96, 0.65);
}
.gap-label {
  position: absolute;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(15, 52, 96, 0.3);
  border-radius: 3px;
  padding: 1px 4px;
  font-size: 10px;
  color: #23395d;
  pointer-events: none;
  z-index: 181;
  white-space: nowrap;
}
.marquee-box {
  position: absolute;
  border: 1px dashed rgba(233, 69, 96, 0.9);
  background: rgba(233, 69, 96, 0.16);
  pointer-events: none;
  z-index: 250;
}

.empty-state { color: var(--text-dim); text-align: center; font-size: 0.9rem; }
.empty-state p { margin-top: 8px; font-size: 0.8rem; }

.toast {
  position: fixed; bottom: 20px; right: 20px; padding: 10px 18px;
  background: var(--surface2); color: var(--text); border-radius: var(--radius);
  font-size: 0.85rem; box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 1000;
}
.toast.show { opacity: 1; }

.keyboard-hint { font-size: 0.78rem; color: var(--text-dim); text-align: center; line-height: 1.35; }
